<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building an upgradeable application · zeppelin_os</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Building an upgradeable application · zeppelin_os"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.zeppelinos.org/index.html"/><meta property="og:description" content="This guide will introduce you to the development of apps in the context of ZeppelinOS."/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,500,700,400italic,700italic"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg"/><h2 class="headerTitle">zeppelin_os</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="https://zeppelinos.org" target="_self">Home</a></li><li><a href="/docs/start.html" target="_self">Docs</a></li><li><a href="/docs/clistart.html" target="_self">CLI</a></li><li><a href="/docs/libstart.html" target="_self">Library</a></li><li><a href="https://blog.zeppelinos.org" target="_self">Blog</a></li><li><a href="https://github.com/zeppelinos" target="_self">Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>GUIDES</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>OVERVIEW</h3><ul><li class="navListItem"><a class="navItem" href="/docs/start.html">ZeppelinOS</a></li></ul></div><div class="navGroup navGroupActive"><h3>GUIDES</h3><ul><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/building.html">Building Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/testing.html">Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/developing.html">Developing Stdlibs</a></li></ul></div><div class="navGroup navGroupActive"><h3>DEMOS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/basil.html">Basil</a></li><li class="navListItem"><a class="navItem" href="/docs/crafting.html">Crafting</a></li></ul></div><div class="navGroup navGroupActive"><h3>REFERENCE</h3><ul><li class="navListItem"><a class="navItem" href="/docs/clifront.html">CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/libfront.html">Library</a></li><li class="navListItem"><a class="navItem" href="/docs/whitepaper.html">Whitepaper</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Building an upgradeable application</h1></header><article><div><span><p>This guide will introduce you to the development of apps in the context of ZeppelinOS.</p>
<h2><a class="anchor" aria-hidden="true" name="write-your-smart-contracts"></a><a href="#write-your-smart-contracts" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Write your smart contracts</h2>
<p>Write your contracts as you would usually do, but replacing constructors with <code>initialize</code> functions. You can do this more easily by using the <code>Initializable</code> helper contract in <a href="https://github.com/zeppelinos/zos-lib"><code>zos-lib</code></a>.</p>
<pre><code class="hljs css sh">npm install zos-lib
</code></pre>
<ul>
<li>For an upgradeable contract development full example, see <a href="https://github.com/zeppelinos/zos-lib/blob/master/examples/simple/contracts/MyContract_v0.sol">the examples folder in <code>zos-lib</code></a>.</li>
<li>For an introductory smart contract development guide, see <a href="https://blog.zeppelin.solutions/a-gentle-introduction-to-ethereum-programming-part-1-783cc7796094">this blog post series</a>.</li>
</ul>
<p>In this example, we'll use this simple contract:</p>
<pre><code class="hljs css sol"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> "zos-lib/contracts/migrations/Initializable.sol";</span>

contract MyContract <span class="hljs-keyword">is</span> Initializable {
  uint256 <span class="hljs-keyword">public</span> x;
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span><span class="hljs-params">(uint256 _x)</span> <span class="hljs-title">isInitializer</span> <span class="hljs-title">public</span> </span>{
    x = _x;
  }
}
</code></pre>
<p>Before you continue, use truffle to compile your contracts:</p>
<pre><code class="hljs css sh">npx truffle compile
</code></pre>
<h2><a class="anchor" aria-hidden="true" name="register-your-initial-contract-implementations"></a><a href="#register-your-initial-contract-implementations" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Register your initial contract implementations</h2>
<p>The next step is to register all the contract implementations of the first <code>version</code> of your project. To do this please run:</p>
<pre><code class="hljs">zos <span class="hljs-keyword">add</span><span class="bash"> &lt;contract_name_1&gt;
</span>zos <span class="hljs-keyword">add</span><span class="bash"> &lt;contract_name_2&gt;
</span>...
zos <span class="hljs-keyword">add</span><span class="bash"> &lt;contract_name_n&gt;
</span></code></pre>
<p>Where <code>&lt;contract_name&gt;</code> is the name of your Solidity contract.</p>
<p>In our example, run:</p>
<pre><code class="hljs">zos <span class="hljs-keyword">add</span><span class="bash"> MyContract
</span></code></pre>
<p>To have your <code>package.zos.json</code> file always up-to-date, run <code>zos add</code> for every new contract you add to your project.</p>
<h2><a class="anchor" aria-hidden="true" name="sync-your-project-with-the-blockchain-with-zos-push"></a><a href="#sync-your-project-with-the-blockchain-with-zos-push" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sync your project with the blockchain with <code>zos push</code></h2>
<p>This command will deploy your upgradeable application to the blockchain:</p>
<pre><code class="hljs">zos push <span class="hljs-comment">--network &lt;network&gt;</span>
</code></pre>
<p>The first time you run this command for a specific network, a new <code>package.zos.&lt;network&gt;.json</code> will be created. This file will reflect the status of your project in that network.</p>
<h2><a class="anchor" aria-hidden="true" name="create-upgradeability-proxies-for-each-of-your-contracts"></a><a href="#create-upgradeability-proxies-for-each-of-your-contracts" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create upgradeability proxies for each of your contracts</h2>
<p>The next commands will deploy new proxies to make your contracts upgradeable:</p>
<pre><code class="hljs">zos create <span class="hljs-tag">&lt;<span class="hljs-name">contract_name_1</span>&gt;</span> --network <span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span>
zos create <span class="hljs-tag">&lt;<span class="hljs-name">contract_name_2</span>&gt;</span> --network <span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span>
...
zos create <span class="hljs-tag">&lt;<span class="hljs-name">contract_name_n</span>&gt;</span> --network <span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span>
</code></pre>
<p>Optionally, you can use the <code>-i</code> flag to call an initialization/migration function after you create the proxy.</p>
<p>In our simple example, we want to call the <code>initialize</code> function, with some value (e.g: 42) thus:</p>
<pre><code class="hljs">zos create MyContract -<span class="hljs-selector-tag">i</span> initialize -<span class="hljs-selector-tag">p</span> <span class="hljs-number">42</span> --network development 
</code></pre>
<p>The proxy addresses, which you'll need to interact with your upgradeable contracts, will be stored in the <code>package.zos.&lt;network&gt;.json</code> file.</p>
<p>Open the <code>package.zos.&lt;network&gt;.json</code> and use the addresses found there to interact with your deployed contracts. Congratulations! The first version of your upgradeable smart contract app is deployed in the blockchain!</p>
<h2><a class="anchor" aria-hidden="true" name="using-a-standard-library"></a><a href="#using-a-standard-library" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a standard library</h2>
<p>In addition to creating proxies for your own contracts, you can also re-use already deployed contracts from a ZeppelinOS standard library. To do so, run the following command, with the name of the npm package of the stdlib you want to use. For example:</p>
<pre><code class="hljs css bash">zos link openzeppelin-zos
</code></pre>
<p>The next <code>push</code> operation will connect your application with the chosen standard library on the target network. However, if you're using development nodes (such as testrpc or ganache), the standard library is not already deployed, since you are running from an empty blockchain. To work around this, you can add a <code>--deploy-stdlib</code> flag to the <code>push</code> command:</p>
<pre><code class="hljs css bash">zos push --deploy-stdlib --network &lt;network&gt;
</code></pre>
<p>This will deploy your entire application to the target network, along with the standard library you are using and all its contracts. This way, you can transparently work in development with the contracts provided by the stdlib.</p>
<p>From there on, you can create proxies for any contract provided by the stdlib:</p>
<pre><code class="hljs css bash">zos create DetailedMintableToken --network &lt;network&gt;
</code></pre>
<h2><a class="anchor" aria-hidden="true" name="update-your-smart-contract-code"></a><a href="#update-your-smart-contract-code" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Update your smart contract code</h2>
<p>Some time later you might want to change your smart contract code: fix a bug, add a new feature, etc.
To do so, update your contracts, making sure you don't change their pre-existing storage structure. This is required
by <strong>ZeppelinOS</strong> upgradeability mechanism. This means you can add new state variables, but you can't remove the ones you already have. In the example above, this could be the new version of <code>MyContract</code>:</p>
<pre><code class="hljs css sol"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> "zos-lib/contracts/migrations/Initializable.sol";</span>

contract MyContract <span class="hljs-keyword">is</span> Initializable {
  uint256 <span class="hljs-keyword">public</span> x;
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span><span class="hljs-params">(uint256 _x)</span> <span class="hljs-title">isInitializer</span> <span class="hljs-title">public</span> </span>{
    x = _x;
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">y</span><span class="hljs-params">()</span> <span class="hljs-title">public</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(uint256)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">1337</span>;
  }
}
</code></pre>
<p>Use truffle to compile the new version of your code:</p>
<pre><code class="hljs css sh">npx truffle compile
</code></pre>
<p>We'll now use <code>zos</code> to register and deploy the new code for <code>MyContract</code> to the blockchain. Sync the new version of your project by running:</p>
<pre><code class="hljs">zos push <span class="hljs-comment">--network &lt;network&gt;</span>
</code></pre>
<p>After running this command, the new versions of your project's contracts are deployed in the blockchain.
However, the already deployed proxies are still running with the old implementations. You need to upgrade
each of the proxies individually. To do so, you just need to run this for every contract:</p>
<pre><code class="hljs">zos<span class="hljs-built_in"> upgrade </span>&lt;contract_name_1&gt; --network &lt;network&gt;
zos<span class="hljs-built_in"> upgrade </span>&lt;contract_name_2&gt; --network &lt;network&gt;
<span class="hljs-built_in">..</span>.
zos<span class="hljs-built_in"> upgrade </span>&lt;contract_name_n&gt; --network &lt;network&gt;
</code></pre>
<p>In our simple example:</p>
<pre><code class="hljs">zos<span class="hljs-built_in"> upgrade </span>MyContract --network development
</code></pre>
<p>Voilà! Your contract has now been upgraded. The address is the same as before, but the code has been changed to the latest version. Repeat the same steps for every code update you want to perform.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="start.html">← ZeppelinOS</a><a class="docs-next button" href="testing.html">Testing an upgradeable application →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/symbol-zeppelin.png" alt="zeppelin_os" width="66" height="58"/></a><div><h5>Docs</h5><a href="https://docs.zeppelinos.org/docs/building.html">Guides</a><a href="https://docs.zeppelinos.org/docs/clifront.html">Reference</a></div><div><h5>More</h5><a href="https://blog.zeppelinos.org">Blog</a><a href="https://github.com/zeppelinos">Github</a></div></section><a href="https://zeppelinos.org" target="_blank" class="fbOpenSource"><img src="/img/logo.svg" alt="zeppelin_os" width="170" height="45"/></a><section class="copyright">Copyright © 2017 zOS Global</section></footer></div></body></html>