<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building upgradeable applications · ZeppelinOS</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Building upgradeable applications · ZeppelinOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.zeppelinos.org/index.html"/><meta property="og:description" content="After installing ZeppelinOS and setting up a `zos` project as described in the [Setup](/docs/setup.html) guide, you are ready to create an upgradeable application."/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,500,700,400italic,700italic"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg"/><h2 class="headerTitle">ZeppelinOS</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="https://zeppelinos.org" target="_self">Main Site</a></li><li><a href="/docs/climain.html" target="_self">CLI API</a></li><li><a href="/docs/libmain.html" target="_self">Lib API</a></li><li><a href="https://blog.zeppelinos.org" target="_self">Blog</a></li><li><a href="https://github.com/zeppelinos" target="_self">Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>GUIDES</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>OVERVIEW</h3><ul><li class="navListItem"><a class="navItem" href="/docs/start.html">ZeppelinOS</a></li></ul></div><div class="navGroup navGroupActive"><h3>GUIDES</h3><ul><li class="navListItem"><a class="navItem" href="/docs/setup.html">Setup</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/building.html">Building upgradeable apps</a></li><li class="navListItem"><a class="navItem" href="/docs/using.html">Using the stdlib</a></li><li class="navListItem"><a class="navItem" href="/docs/developing.html">Developing stdlibs</a></li><li class="navListItem"><a class="navItem" href="/docs/testing.html">Testing</a></li></ul></div><div class="navGroup navGroupActive"><h3>DEMOS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/basil.html">Basil</a></li><li class="navListItem"><a class="navItem" href="/docs/crafty.html">Crafty</a></li></ul></div><div class="navGroup navGroupActive"><h3>LIBRARY</h3><ul><li class="navListItem"><a class="navItem" href="/docs/libstart.html">Library</a></li></ul></div><div class="navGroup navGroupActive"><h3>FURTHER REFERENCE</h3><ul><li class="navListItem"><a class="navItem" href="/docs/apis.html">APIs</a></li><li class="navListItem"><a class="navItem" href="/docs/stdlib.html">OpenZeppelin stdlib</a></li><li class="navListItem"><a class="navItem" href="/docs/advanced.html">Advanced topics</a></li><li class="navListItem"><a class="navItem" href="/docs/whitepaper.html">Whitepaper</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Building upgradeable applications</h1></header><article><div><span><p>After installing ZeppelinOS and setting up a <code>zos</code> project as described in the <a href="/docs/setup.html">Setup</a> guide, you are ready to create an upgradeable application.</p>
<p>You can start by writing the contracts as you would normally do, but replacing constructors with
<code>initialize</code> functions using the modifier from <code>zos-lib</code>. To install the lib:</p>
<pre><code class="hljs">npm install zos-<span class="hljs-class"><span class="hljs-keyword">lib</span></span>
</code></pre>
<p>A simple contract would look like this:</p>
<pre><code class="hljs"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> "zos-lib/contracts/migrations/Migratable.sol";</span>

contract MyContract <span class="hljs-keyword">is</span> Migratable {
  uint256 <span class="hljs-keyword">public</span> x;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span><span class="hljs-params">(uint256 _x)</span> <span class="hljs-title">isInitializer</span><span class="hljs-params">(<span class="hljs-string">"MyContract"</span>, <span class="hljs-string">"0"</span>)</span> <span class="hljs-title">public</span> </span>{
    x = _x;
  }
}
</code></pre>
<p>You might have noted that our sample contract has an <code>initialize</code> function instead of the standard contstructor. This is a requirement of ZeppelinOS's upgradeabiltiy system, you can learn more about this in our <a href="/docs/advanced.html">Advanced topics</a> section.</p>
<p>You can now compile the contract with:</p>
<pre><code class="hljs"><span class="hljs-attribute">npx truffle compile</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" name="initial-deployment"></a><a href="#initial-deployment" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initial Deployment</h2>
<p>Register all the contract implementations of the first version of your
project running:</p>
<pre><code class="hljs">zos <span class="hljs-keyword">add</span><span class="bash"> &lt;contract_name_1&gt;
</span>zos <span class="hljs-keyword">add</span><span class="bash"> &lt;contract_name_2&gt;
</span>...
zos <span class="hljs-keyword">add</span><span class="bash"> &lt;contract_name_n&gt;
</span></code></pre>
<p>In our example, run:</p>
<pre><code class="hljs">zos add MyContract
</code></pre>
<p>If you are working in a local development network like <a href="http://truffleframework.com/ganache/">Ganache</a>, you will need to <a href="http://truffleframework.com/docs/getting_started/project#alternative-migrating-with-ganache">configure</a> your <code>truffle.js</code> file before running the <code>push</code> command.</p>
<p>You can now push your application to the desired network by running:</p>
<pre><code class="hljs">zos push <span class="hljs-comment">--network &lt;network&gt;</span>
</code></pre>
<p>which will create a <code>zos.&lt;network&gt;.json</code> file with all the information specific to the chosen network. The format of this file is discussed in the <a href="/docs/advanced.html">Advanced topics</a> section.</p>
<p>To create an upgradeable version of each of your contracts, run:</p>
<pre><code class="hljs">zos create <span class="hljs-tag">&lt;<span class="hljs-name">contract_name_1</span>&gt;</span> --network <span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span>
zos create <span class="hljs-tag">&lt;<span class="hljs-name">contract_name_2</span>&gt;</span> --network <span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span>
...
zos create <span class="hljs-tag">&lt;<span class="hljs-name">contract_name_n</span>&gt;</span> --network <span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span>
</code></pre>
<p>This command takes an optional <code>--init</code> flag to call an initialization/migration
function after you create the contract. In our simple example we want to pass a value (<em>e.g.</em>: 42) to the initialize function:</p>
<pre><code class="hljs"><span class="hljs-comment">zos</span> <span class="hljs-comment">create</span> <span class="hljs-comment">MyContract</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">init</span> <span class="hljs-comment">initialize</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">args</span> <span class="hljs-comment">42</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">network</span> <span class="hljs-comment">development</span>
</code></pre>
<p>After these simple steps, your upgradeable application is now on-chain!</p>
<h2><a class="anchor" aria-hidden="true" name="upgrading-your-contracts"></a><a href="#upgrading-your-contracts" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrading your contracts</h2>
<p>If, at a later stage, you want to upgrade your smart contracts' code in order to fix a bug or add a new feature, you can do it seamlessly using ZeppelinOS.</p>
<p>Note that while ZeppelinOS supports arbitrary changes in functionality, you will need to preserve all variables that appear in prior versions of your contracts, declaring any new variables below the already existing ones. You can find details on this in the <a href="/docs/advanced.html">Advanced topics</a> page.</p>
<p>Once you've made the desired changes to your contracts, recompile them and push them to the network:</p>
<pre><code class="hljs">npx truffle <span class="hljs-keyword">compile</span>
zos <span class="hljs-keyword">push</span> --network &lt;network&gt;
</code></pre>
<p>Then, upgrade the already deployed contracts:</p>
<pre><code class="hljs">zos<span class="hljs-built_in"> upgrade </span>&lt;contract_name_1&gt; --network &lt;network&gt;
zos<span class="hljs-built_in"> upgrade </span>&lt;contract_name_2&gt; --network &lt;network&gt;
<span class="hljs-built_in">..</span>.
zos<span class="hljs-built_in"> upgrade </span>&lt;contract_name_n&gt; --network &lt;network&gt;
</code></pre>
<p>In our simple example:</p>
<pre><code class="hljs">zos<span class="hljs-built_in"> upgrade </span>MyContract --network development
</code></pre>
<p>The address of the upgraded contracts is the same as before, but the code has been changed to the new
version.</p>
<p><em>Voilà!</em> You have deployed and upgraded an application using ZeppelinOS.</p>
<p>If you want to use the ZeppelinOS standard libraries, please follow our <a href="/docs/using.html">Using the stdlib in your app</a> guide. You can also check the API reference with <a href="/docs/climain.html">all the available commands of zos</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="setup.html">← Setup</a><a class="docs-next button" href="using.html">Using the stdlib in your app →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/symbol-zeppelin.png" alt="ZeppelinOS" width="66" height="58"/></a><div><h5>Docs</h5><a href="https://docs.zeppelinos.org/docs/building.html">Guides</a><a href="https://docs.zeppelinos.org/docs/clifront.html">Reference</a></div><div><h5>More</h5><a href="https://blog.zeppelinos.org">Blog</a><a href="https://github.com/zeppelinos">Github</a></div></section><a href="https://zeppelinos.org" target="_blank" class="fbOpenSource"><img src="/img/logo.svg" alt="ZeppelinOS" width="170" height="45"/></a><section class="copyright">Copyright © 2017 zOS Global</section></footer></div><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102575245-1', 'auto');
              ga('send', 'pageview');
            </script></body></html>